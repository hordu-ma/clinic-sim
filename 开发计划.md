# ä¸´åºŠåŒ»å­¦æ¨¡æ‹Ÿé—®è¯Šç³»ç»Ÿ - å¼€å‘è®¡åˆ’

> **ç‰ˆæœ¬**ï¼šv1.1ï¼ˆ2026-01-10ï¼‰  
> **é¡¹ç›®å‘¨æœŸ**ï¼š6 å‘¨ï¼ˆçº¦ 1.5 ä¸ªæœˆï¼‰  
> **æ ¸å¿ƒå˜æ›´**ï¼šç”¨æˆ·æ•°æ®ä¸å…¶ä»–ç³»ç»Ÿå…±ç”¨ï¼Œå‰ç«¯ä»…æä¾›ç™»å½•åŠŸèƒ½

---

## ğŸ“‹ **é¡¹ç›®æ¦‚è¿°**

### æ ¸å¿ƒç›®æ ‡

æ„å»ºä¸€ä¸ªç”¨äº**ä¸´åºŠåŒ»å­¦æ•™å­¦**çš„æ¨¡æ‹Ÿé—®è¯Šç³»ç»Ÿï¼š

- å­¦ç”Ÿè´Ÿè´£è¯Šæ–­
- å¤§æ¨¡å‹**å§‹ç»ˆæ‰®æ¼”ç—…äºº**
- æœ¬åœ° Win11ï¼ˆRTX Pro 500ï¼‰å¼€å‘
- ç”Ÿäº§ç¯å¢ƒ A/B åŒæœºéƒ¨ç½²
- å…¨æµç¨‹ Docker åŒ–ï¼Œæ•°æ®å¯å®¡è®¡

### æ¶æ„æ¦‚è§ˆ

- **A æœåŠ¡å™¨ï¼ˆå…¥å£å±‚ï¼‰**ï¼šNginxï¼ˆHTTPS/SSE åä»£ï¼‰+ é™æ€å‰ç«¯
- **B æœåŠ¡å™¨ï¼ˆæ ¸å¿ƒå±‚ï¼ŒGPUï¼‰**ï¼šFastAPI + vLLM + PostgreSQL + MinIO

### æ ¸å¿ƒåŸåˆ™

- åç«¯**åªä¾èµ– OpenAI å…¼å®¹æ¥å£**
- æ¨ç†æœåŠ¡åœ°å€é€šè¿‡ `LLM_BASE_URL` åˆ‡æ¢
- å¼€å‘/ç”Ÿäº§æ¶æ„ä¿æŒä¸€è‡´
- æ‰€æœ‰ç”¨æˆ·è¡Œä¸ºä¸ç»“æœ**å¯å®¡è®¡ã€å¯å¤ç°**
- **ç”¨æˆ·æ•°æ®ä¸å…¶ä»–ç³»ç»Ÿå…±ç”¨ï¼Œæ— æ³¨å†ŒåŠŸèƒ½**

---

## ğŸ“… **è¯¦ç»†å¼€å‘è®¡åˆ’**

### **ç¬¬ 1 å‘¨ï¼šç¯å¢ƒåŸºç¡€è®¾æ–½ï¼ˆé˜¶æ®µ 1-2ï¼‰**

#### **Day 1-2ï¼šDocker æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º**

**ç›®æ ‡**ï¼šè®© PostgreSQL + MinIO è·‘èµ·æ¥

**ä»»åŠ¡æ¸…å•**ï¼š

1. **ç¼–å†™ `src/infra/compose/dev.yml`**

   - PostgreSQL æœåŠ¡ï¼ˆç«¯å£ 5432ï¼Œç‰ˆæœ¬ 15+ï¼‰
   - MinIO æœåŠ¡ï¼ˆç«¯å£ 9000/9001ï¼‰
   - é…ç½®æ•°æ®å·æŒä¹…åŒ–ï¼ˆæœ¬åœ°ç›®å½•æˆ– Docker volumeï¼‰
   - è®¾ç½®åˆå§‹ç”¨æˆ·åå¯†ç ï¼ˆç¯å¢ƒå˜é‡ï¼‰

2. **éªŒè¯åŸºç¡€æœåŠ¡**
   ```bash
   cd src/infra/compose
   docker-compose -f dev.yml up -d
   ```
   - ç¡®è®¤ PostgreSQL å¯è¿æ¥ï¼ˆä½¿ç”¨ `psql` æˆ– DBeaverï¼‰
   - ç¡®è®¤ MinIO Web æ§åˆ¶å°å¯è®¿é—®ï¼ˆhttp://localhost:9001ï¼‰
   - åˆ›å»º MinIO bucketï¼š`clinic-sim-dev`

**éªŒæ”¶æ ‡å‡†**ï¼š

- [x] `docker-compose ps` æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡ running
- [x] å¯é€šè¿‡ psql è¿æ¥ PostgreSQL
- [x] MinIO æ§åˆ¶å°å¯ç™»å½•ï¼Œbucket å·²åˆ›å»º
  > Username&password: minioadmin/minioadmin

---

#### **Day 3-5ï¼šæœ¬åœ° vLLM æ¨ç†æœåŠ¡**

**ç›®æ ‡**ï¼šåœ¨ WSL2 ä¸Šè¿è¡Œ Qwen æ¨¡å‹ï¼Œæä¾› OpenAI å…¼å®¹æ¥å£

**ä»»åŠ¡æ¸…å•**ï¼š

1. **é€‰æ‹©æ¨¡å‹å¹¶ä¸‹è½½**ï¼ˆæ¨èä»å°åˆ°å¤§æµ‹è¯•ï¼‰

   - ä¼˜å…ˆï¼šQwen2.5-1.5B-Instructï¼ˆå…ˆæµ‹æ˜¾å­˜ï¼‰
   - å¤‡é€‰ï¼šQwen2.5-3B-Instructï¼ˆå¯èƒ½éœ€è¦é‡åŒ–ï¼Œå¦‚ AWQ/GPTQï¼‰
   - ä¸‹è½½æ–¹å¼ï¼šmodelscope æˆ– HuggingFace

2. **å®‰è£… vLLMï¼ˆWSL2 å†…ç‹¬ç«‹ç¯å¢ƒï¼‰**

   - ç¡®è®¤ CUDA ç¯å¢ƒï¼ˆ`nvidia-smi` è¾“å‡ºæ­£å¸¸ï¼‰
   - åˆ›å»ºç‹¬ç«‹ venvï¼š`python3 -m venv ~/vllm-env`
   - æ¿€æ´»å¹¶å®‰è£…ï¼š`pip install vllm`

3. **å¯åŠ¨ vLLM æœåŠ¡**

   ```bash
   python -m vllm.entrypoints.openai.api_server \
     --model <æ¨¡å‹è·¯å¾„> \
     --port 8001 \
     --host 0.0.0.0 \
     --max-model-len 4096 \
     --gpu-memory-utilization 0.85
   ```

4. **éªŒè¯ OpenAI å…¼å®¹æ¥å£**

   ```bash
   # æŸ¥çœ‹æ¨¡å‹åˆ—è¡¨
   curl http://localhost:8001/v1/models

   # æµ‹è¯•æµå¼å¯¹è¯
   curl http://localhost:8001/v1/chat/completions \
     -H "Content-Type: application/json" \
     -d '{
       "model": "<æ¨¡å‹å>",
       "messages": [{"role": "user", "content": "ä½ å¥½"}],
       "stream": true
     }'
   ```

5. **æ€§èƒ½æµ‹è¯•ä¸è°ƒä¼˜**

   - è®°å½•é¦– token å»¶è¿Ÿï¼ˆTTFTï¼‰
   - æµ‹è¯•å¹¶å‘è¯·æ±‚ï¼ˆ2-5 ä¸ªï¼‰
   - ç›‘æ§æ˜¾å­˜å ç”¨ï¼ˆä¸è¶…è¿‡ 4GBï¼‰
   - è°ƒæ•´ `max_model_len` æˆ– `gpu_memory_utilization`

6. **ç¼–å†™å¯åŠ¨è„šæœ¬**
   - åˆ›å»º `src/scripts/start_vllm_dev.sh`
   - åŒ…å«ï¼šç¯å¢ƒå˜é‡ã€æ¨¡å‹è·¯å¾„ã€å¯åŠ¨å‚æ•°
   - æ”¯æŒå¯é€‰å‚æ•°ï¼ˆ`ATTN_BACKEND`ã€`ENFORCE_EAGER`ã€`DTYPE`ã€`MAX_MODEL_LEN` ç­‰ï¼‰ï¼Œä¾¿äºåœ¨ 6GB æ˜¾å­˜ä¸‹åˆ‡æ¢åç«¯å’Œç²¾åº¦

**æœ¬æ¬¡éªŒè¯å‚æ•°ä¸è¡¨ç°ï¼ˆRTX Pro 500 6GB, WSL2ï¼‰**ï¼š

- å¯åŠ¨å‚æ•°ï¼š`ATTN_BACKEND=TRITON_ATTN ENFORCE_EAGER=1 DTYPE=float16 MAX_MODEL_LEN=1024 GPU_MEMORY_UTILIZATION=0.8 MAX_NUM_SEQS=3`
- æ¨¡å‹è·¯å¾„ï¼š`/home/malig/.cache/modelscope/hub/models/Qwen/Qwen2.5-1.5B-Instruct`
- ç°è±¡ï¼šé¿å…é»˜è®¤ FLASH_ATTN è§¦å‘çš„ PTX å·¥å…·é“¾æŠ¥é”™ï¼Œæµå¼å’Œ 3 è·¯å¹¶å‘å‡ 200 æˆåŠŸï¼›æ—  OOM
- å»ºè®®ï¼šå¦‚å†é‡ç¼–è¯‘ç±»é”™è¯¯ï¼Œå¯ä¿æŒä¸Šè¿°å‚æ•°ï¼›å¦‚æ˜¾å­˜åƒç´§å†é™ `MAX_MODEL_LEN` æˆ– `GPU_MEMORY_UTILIZATION`

**éªŒæ”¶æ ‡å‡†**ï¼š

- [x] vLLM æœåŠ¡ç¨³å®šè¿è¡Œï¼ˆæ—  OOMï¼‰
- [x] `/v1/chat/completions` æµå¼å“åº”æ­£å¸¸
- [x] å¹¶å‘ 3 ä¸ªè¯·æ±‚æ— å´©æºƒ
- [x] å¯åŠ¨è„šæœ¬å¯ä¸€é”®è¿è¡Œ

---

### **ç¬¬ 2 å‘¨ï¼šFastAPI åç«¯éª¨æ¶ï¼ˆé˜¶æ®µ 3ï¼‰**

#### **Day 6-7ï¼šé¡¹ç›®ä¾èµ–ä¸é…ç½®ç®¡ç†**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **å®Œå–„ `pyproject.toml`**

   - æ·»åŠ æ ¸å¿ƒä¾èµ–ï¼š
     ```toml
     dependencies = [
         "fastapi>=0.110.0",
         "uvicorn[standard]>=0.27.0",
         "sqlalchemy>=2.0.25",
         "alembic>=1.13.1",
         "httpx>=0.26.0",
         "pydantic>=2.6.0",
         "pydantic-settings>=2.1.0",
         "pyjwt>=2.8.0",
         "psycopg[binary]>=3.1.17",
         "minio>=7.2.3",
         "python-multipart>=0.0.6",
         "passlib[bcrypt]>=1.7.4",
     ]
     ```
   - é…ç½®å¼€å‘ä¾èµ–ï¼špytestã€ruffã€mypy

2. **åˆ›å»ºé…ç½®æ¨¡å—**ï¼ˆ`src/apps/api/config.py`ï¼‰

   - ä½¿ç”¨ `pydantic_settings.BaseSettings`
   - æ”¯æŒ `.env` æ–‡ä»¶åŠ è½½
   - å¿…éœ€é…ç½®é¡¹ï¼š
     ```python
     DATABASE_URL: str
     MINIO_ENDPOINT: str
     MINIO_ACCESS_KEY: str
     MINIO_SECRET_KEY: str
     LLM_BASE_URL: str
     LLM_MODEL: str
     JWT_SECRET: str
     JWT_ALGORITHM: str = "HS256"
     JWT_EXPIRE_MINUTES: int = 60 * 24 * 7  # 7å¤©
     ENV: str = "dev"
     ```

3. **åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶**
   - `.env.example`ï¼ˆæ¨¡æ¿ï¼Œæäº¤åˆ° gitï¼‰
   - `.env`ï¼ˆæœ¬åœ°å¼€å‘é…ç½®ï¼Œä¸æäº¤ï¼‰
   - ç¤ºä¾‹å†…å®¹ï¼š
     ```env
     DATABASE_URL=postgresql+psycopg://postgres:postgres@localhost:5432/clinic_sim
     MINIO_ENDPOINT=localhost:9000
     MINIO_ACCESS_KEY=minioadmin
     MINIO_SECRET_KEY=minioadmin
     LLM_BASE_URL=http://localhost:8001
     LLM_MODEL=qwen2.5-1.5b-instruct
     JWT_SECRET=your-secret-key-change-in-production
     ENV=dev
     ```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [x] `uv sync` æˆåŠŸå®‰è£…æ‰€æœ‰ä¾èµ–
- [x] `config.py` å¯æ­£ç¡®åŠ è½½ `.env`
- [x] `ruff check .` æ— é”™è¯¯

---

#### **Day 8-10ï¼šæ•°æ®åº“æ¨¡å‹ä¸è¿ç§»**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **è®¾è®¡æ•°æ®åº“æ¨¡å‹**ï¼ˆ`src/apps/api/models/`ï¼‰

   **ç”¨æˆ·è¡¨**ï¼ˆ`users.py`ï¼‰ï¼š

   ```python
   class User(Base):
       __tablename__ = "users"

       id: Mapped[int] = mapped_column(primary_key=True)
       username: Mapped[str] = mapped_column(String(50), unique=True, index=True)
       hashed_password: Mapped[str] = mapped_column(String(255))
       full_name: Mapped[str] = mapped_column(String(100))
       role: Mapped[str] = mapped_column(String(20))  # student, teacher, admin
       is_active: Mapped[bool] = mapped_column(default=True)
       external_user_id: Mapped[str | None] = mapped_column(String(100), unique=True, nullable=True)  # å¤–éƒ¨ç³»ç»Ÿç”¨æˆ·ID
       created_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)
       updated_at: Mapped[datetime] = mapped_column(default=datetime.utcnow, onupdate=datetime.utcnow)
   ```

   > **æ³¨æ„**ï¼š`external_user_id` ç”¨äºä¸å…¶ä»–ç³»ç»Ÿç”¨æˆ·åŒæ­¥

   **ç—…ä¾‹è¡¨**ï¼ˆ`cases.py`ï¼‰ï¼š

   - åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€éš¾åº¦ã€ç§‘å®¤ï¼‰
   - ç—…ä¾‹æ•°æ®ï¼ˆJSON å­—æ®µï¼ŒåŒ…å«ä¸»è¯‰ã€ç°ç—…å²ã€ä½“å¾ã€æ£€æŸ¥é¡¹ç­‰ï¼‰
   - æ ‡å‡†ç­”æ¡ˆï¼ˆJSON å­—æ®µï¼‰

   **ä¼šè¯è¡¨**ï¼ˆ`sessions.py`ï¼‰ï¼š

   - å­¦ç”Ÿ IDï¼ˆå¤–é”® â†’ usersï¼‰
   - ç—…ä¾‹ IDï¼ˆå¤–é”® â†’ casesï¼‰
   - ä¼šè¯çŠ¶æ€ï¼ˆè¿›è¡Œä¸­ã€å·²æäº¤ã€å·²è¯„åˆ†ï¼‰
   - å¼€å§‹/ç»“æŸæ—¶é—´

   **æ¶ˆæ¯è¡¨**ï¼ˆ`messages.py`ï¼‰ï¼š

   - ä¼šè¯ IDï¼ˆå¤–é”® â†’ sessionsï¼‰
   - è§’è‰²ï¼ˆuser / assistantï¼‰
   - å†…å®¹ï¼ˆTEXTï¼‰
   - token æ•°ã€å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
   - æ—¶é—´æˆ³

   **æ£€æŸ¥ç”³è¯·è¡¨**ï¼ˆ`test_requests.py`ï¼‰ï¼š

   - ä¼šè¯ ID
   - æ£€æŸ¥ç±»å‹ï¼ˆå¦‚ï¼šè¡€å¸¸è§„ã€X å…‰ï¼‰
   - ç»“æœï¼ˆJSONï¼‰
   - ç”³è¯·æ—¶é—´

   **è¯„åˆ†è¡¨**ï¼ˆ`scores.py`ï¼‰ï¼š

   - ä¼šè¯ IDï¼ˆå”¯ä¸€ï¼‰
   - æ€»åˆ†ã€å„ç»´åº¦å¾—åˆ†
   - è¯„åˆ†ä¾æ®ï¼ˆJSONï¼Œå¯å®¡è®¡ï¼‰
   - è¯„åˆ†æ—¶é—´

   **å®¡è®¡æ—¥å¿—è¡¨**ï¼ˆ`audit_logs.py`ï¼‰ï¼š

   - ç”¨æˆ· ID
   - æ“ä½œç±»å‹ï¼ˆloginã€chatã€submit ç­‰ï¼‰
   - è¯¦æƒ…ï¼ˆJSONï¼‰
   - IPã€æ—¶é—´æˆ³

2. **é…ç½® Alembic**

   ```bash
   cd src/apps/api
   alembic init migrations
   ```

   - ä¿®æ”¹ `alembic.ini`ï¼š`sqlalchemy.url` æ”¹ä¸ºä»é…ç½®è¯»å–
   - ä¿®æ”¹ `migrations/env.py`ï¼šå¯¼å…¥æ‰€æœ‰æ¨¡å‹ï¼Œè¿æ¥é…ç½®

3. **ç”Ÿæˆåˆå§‹è¿ç§»**

   ```bash
   alembic revision --autogenerate -m "Initial schema"
   alembic upgrade head
   ```

4. **éªŒè¯è¡¨åˆ›å»º**
   ```bash
   psql $DATABASE_URL -c "\dt"
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] æ‰€æœ‰è¡¨å·²åˆ›å»ºï¼ˆ7 å¼ è¡¨ï¼‰
- [ ] å¤–é”®çº¦æŸæ­£ç¡®
- [ ] ç´¢å¼•å·²å»ºç«‹ï¼ˆusername, external_user_id, session_id ç­‰ï¼‰
- [ ] Alembic ç‰ˆæœ¬ç®¡ç†æ­£å¸¸ï¼ˆ`alembic current` æ˜¾ç¤ºç‰ˆæœ¬ï¼‰

---

#### **Day 11-12ï¼šFastAPI åº”ç”¨å¯åŠ¨ä¸è·¯ç”±æ¡†æ¶**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **åˆ›å»ºåº”ç”¨å…¥å£**ï¼ˆ`src/apps/api/main.py`ï¼‰

   ```python
   from fastapi import FastAPI
   from fastapi.middleware.cors import CORSMiddleware
   from .config import settings
   from .routes import auth, cases, sessions, chat

   app = FastAPI(
       title="Clinic Simulation API",
       version="0.1.0",
       docs_url="/docs" if settings.ENV == "dev" else None,
   )

   # CORS é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒå…è®¸æœ¬åœ°å‰ç«¯ï¼‰
   app.add_middleware(
       CORSMiddleware,
       allow_origins=["http://localhost:5173"] if settings.ENV == "dev" else [],
       allow_credentials=True,
       allow_methods=["*"],
       allow_headers=["*"],
   )

   # æ³¨å†Œè·¯ç”±
   app.include_router(auth.router, prefix="/api/auth", tags=["auth"])
   app.include_router(cases.router, prefix="/api/cases", tags=["cases"])
   app.include_router(sessions.router, prefix="/api/sessions", tags=["sessions"])
   app.include_router(chat.router, prefix="/api/chat", tags=["chat"])

   @app.get("/health")
   async def health_check():
       return {"status": "ok"}
   ```

2. **åˆ›å»ºè·¯ç”±æ¨¡å—ç»“æ„**ï¼ˆç©ºå®ç°ï¼Œå…ˆå»ºæ¡†æ¶ï¼‰

   - `src/apps/api/routes/auth.py`ï¼ˆç™»å½•ã€JWT éªŒè¯ï¼‰
   - `src/apps/api/routes/cases.py`ï¼ˆç—…ä¾‹åˆ—è¡¨ã€è¯¦æƒ…ï¼‰
   - `src/apps/api/routes/sessions.py`ï¼ˆä¼šè¯åˆ›å»ºã€åˆ—è¡¨ã€è¯¦æƒ…ï¼‰
   - `src/apps/api/routes/chat.py`ï¼ˆSSE æµå¼å¯¹è¯ï¼‰

3. **åˆ›å»ºä¾èµ–æ³¨å…¥æ¨¡å—**ï¼ˆ`src/apps/api/dependencies.py`ï¼‰

   ```python
   from fastapi import Depends, HTTPException, status
   from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
   import jwt
   from .config import settings

   security = HTTPBearer()

   async def get_current_user(
       credentials: HTTPAuthorizationCredentials = Depends(security)
   ):
       token = credentials.credentials
       try:
           payload = jwt.decode(token, settings.JWT_SECRET, algorithms=[settings.JWT_ALGORITHM])
           user_id = payload.get("sub")
           if user_id is None:
               raise HTTPException(status_code=401, detail="Invalid token")
           return user_id  # åç»­ä»æ•°æ®åº“åŠ è½½å®Œæ•´ç”¨æˆ·å¯¹è±¡
       except jwt.ExpiredSignatureError:
           raise HTTPException(status_code=401, detail="Token expired")
       except jwt.InvalidTokenError:
           raise HTTPException(status_code=401, detail="Invalid token")
   ```

4. **å¯åŠ¨éªŒè¯**
   ```bash
   cd /home/malig/code-repos/clinic-sim
   uv run uvicorn src.apps.api.main:app --reload --host 0.0.0.0 --port 8000
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] è®¿é—® http://localhost:8000/docs å¯è§ Swagger UI
- [ ] `/health` è¿”å› `{"status": "ok"}`
- [ ] è·¯ç”±ç»“æ„æ¸…æ™°ï¼Œæ ‡ç­¾åˆ†ç±»æ­£ç¡®
- [ ] æ— å¯åŠ¨é”™è¯¯

---

### **ç¬¬ 3 å‘¨ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆé˜¶æ®µ 4-5ï¼‰**

#### **Day 13-15ï¼šè®¤è¯ç³»ç»Ÿï¼ˆä»…ç™»å½•ï¼Œæ— æ³¨å†Œï¼‰**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **ç”¨æˆ·æ•°æ®åŒæ­¥æœºåˆ¶**ï¼ˆä¸å…¶ä»–ç³»ç»Ÿé›†æˆï¼‰

   - **æ–¹æ¡ˆ A**ï¼šå®šæ—¶åŒæ­¥ï¼ˆæ¨èåˆæœŸï¼‰
     - ç¼–å†™è„šæœ¬ `src/scripts/sync_users.py`
     - ä»å…¶ä»–ç³»ç»Ÿ API/æ•°æ®åº“æ‹‰å–ç”¨æˆ·æ•°æ®
     - æ›´æ–°æœ¬åœ° `users` è¡¨ï¼ˆæ ¹æ® `external_user_id` åŒ¹é…ï¼‰
   - **æ–¹æ¡ˆ B**ï¼šå®æ—¶åŒæ­¥ï¼ˆåæœŸä¼˜åŒ–ï¼‰
     - é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆKafka/RabbitMQï¼‰æ¥æ”¶ç”¨æˆ·å˜æ›´äº‹ä»¶
     - Webhook å›è°ƒæ›´æ–°æœ¬åœ°ç”¨æˆ·

2. **ç™»å½• API å®ç°**ï¼ˆ`POST /api/auth/login`ï¼‰

   ```python
   # è¾“å…¥ï¼šusername, password
   # éªŒè¯ï¼šæŸ¥è¯¢æœ¬åœ° users è¡¨ï¼Œæ ¡éªŒå¯†ç ï¼ˆbcryptï¼‰
   # è¿”å›ï¼šJWT tokenï¼ˆåŒ…å« user_id, roleï¼‰
   ```

   - ä½¿ç”¨ `passlib` è¿›è¡Œå¯†ç å“ˆå¸ŒéªŒè¯
   - JWT payloadï¼š`{"sub": user_id, "role": role, "exp": ...}`
   - è¿”å›ï¼š`{"access_token": "...", "token_type": "bearer"}`

3. **å½“å‰ç”¨æˆ·ä¿¡æ¯ API**ï¼ˆ`GET /api/users/me`ï¼‰

   ```python
   # éœ€è¦ JWT è®¤è¯
   # è¿”å›å½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆä¸å«å¯†ç ï¼‰
   ```

4. **æµ‹è¯•**
   - ä½¿ç”¨ Postman æµ‹è¯•ç™»å½•æµç¨‹
   - éªŒè¯ JWT è¿‡æœŸæ—¶é—´
   - æµ‹è¯•æ— æ•ˆ token è¿”å› 401

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] ç™»å½•æ¥å£è¿”å›æœ‰æ•ˆ JWT
- [ ] JWT å¯æ­£ç¡®è§£æç”¨æˆ·ä¿¡æ¯
- [ ] `/api/users/me` éœ€è¦è®¤è¯æ‰èƒ½è®¿é—®
- [ ] æ— æ³¨å†Œæ¥å£ï¼ˆå‰ç«¯ä»…æä¾›ç™»å½•è¡¨å•ï¼‰

---

#### **Day 16-18ï¼šç—…ä¾‹ç³»ç»Ÿ**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **ç—…ä¾‹æ•°æ®å‡†å¤‡**

   - åœ¨ `src/cases/` ä¸‹åˆ›å»º 2-3 ä¸ªç¤ºä¾‹ç—…ä¾‹ JSON
   - ç—…ä¾‹ç»“æ„ç¤ºä¾‹ï¼ˆ`src/cases/case_001.json`ï¼‰ï¼š
     ```json
     {
       "title": "æ€¥æ€§ä¸Šå‘¼å¸é“æ„ŸæŸ“",
       "difficulty": "easy",
       "department": "internal_medicine",
       "patient_info": {
         "age": 28,
         "gender": "male",
         "occupation": "ç¨‹åºå‘˜"
       },
       "chief_complaint": "å‘çƒ­ã€å’½ç—› 3 å¤©",
       "present_illness": "æ‚£è€… 3 å¤©å‰å—å‡‰åå‡ºç°å‘çƒ­...",
       "past_history": {
         "diseases": [],
         "allergies": [],
         "medications": []
       },
       "physical_exam": {
         "visible": {
           "temperature": "38.5Â°C",
           "pulse": "90æ¬¡/åˆ†"
         },
         "on_request": {
           "throat": "å’½éƒ¨å……è¡€ï¼Œæ‰æ¡ƒä½“Iåº¦è‚¿å¤§"
         }
       },
       "available_tests": [
         {
           "type": "blood_routine",
           "name": "è¡€å¸¸è§„",
           "result": {
             "wbc": "12.5 Ã— 10^9/L",
             "neutrophil": "75%"
           }
         }
       ],
       "standard_diagnosis": {
         "primary": "æ€¥æ€§ä¸Šå‘¼å¸é“æ„ŸæŸ“",
         "differential": ["æ€¥æ€§æ‰æ¡ƒä½“ç‚", "æµè¡Œæ€§æ„Ÿå†’"]
       },
       "key_points": ["å‘çƒ­æ—¶ç¨‹", "å’½ç—›", "å’½éƒ¨ä½“å¾"]
     }
     ```

2. **ç—…ä¾‹å¯¼å…¥è„šæœ¬**ï¼ˆ`src/scripts/import_cases.py`ï¼‰

   ```python
   # è¯»å– src/cases/*.json
   # è§£æå¹¶æ’å…¥ cases è¡¨
   # å»é‡ï¼ˆæ ¹æ® title æˆ–å”¯ä¸€æ ‡è¯†ï¼‰
   ```

3. **ç—…ä¾‹ API å®ç°**

   - `GET /api/cases`ï¼ˆåˆ†é¡µã€éš¾åº¦ç­›é€‰ã€ç§‘å®¤ç­›é€‰ï¼‰
     ```python
     # è¿”å›åˆ—è¡¨ï¼ˆä¸å«æ•æ„Ÿä¿¡æ¯ï¼šæ ‡å‡†ç­”æ¡ˆã€å…³é”®ç‚¹ï¼‰
     # å­¦ç”Ÿç«¯ä»…å¯è§ï¼štitle, difficulty, department
     ```
   - `GET /api/cases/{case_id}`ï¼ˆè¯¦æƒ…ï¼‰
     ```python
     # å­¦ç”Ÿç«¯ï¼šä»…è¿”å›åŸºæœ¬ä¿¡æ¯ã€ä¸»è¯‰ï¼ˆä¸å«ç­”æ¡ˆï¼‰
     # æ•™å¸ˆç«¯ï¼šè¿”å›å®Œæ•´æ•°æ®ï¼ˆåŒ…å«æ ‡å‡†ç­”æ¡ˆï¼‰
     ```
   - `POST /api/cases`ï¼ˆç®¡ç†å‘˜åˆ›å»ºï¼Œæš‚æ—¶ä¸å®ç°ï¼‰

4. **æ‰§è¡Œå¯¼å…¥**
   ```bash
   uv run python src/scripts/import_cases.py
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] è‡³å°‘ 2 ä¸ªç—…ä¾‹æˆåŠŸå¯¼å…¥æ•°æ®åº“
- [ ] `/api/cases` è¿”å›ç—…ä¾‹åˆ—è¡¨ï¼ˆæ— æ•æ„Ÿä¿¡æ¯ï¼‰
- [ ] `/api/cases/{case_id}` è¿”å›æ­£ç¡®çš„è¿‡æ»¤æ•°æ®
- [ ] ç—…ä¾‹ JSON æ ¼å¼è§„èŒƒï¼Œå¯æ‰©å±•

---

#### **Day 19-21ï¼šä¼šè¯ä¸å¯¹è¯æ ¸å¿ƒï¼ˆé‡ç‚¹ï¼‰**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **ä¼šè¯ç®¡ç† API**

   - `POST /api/sessions`ï¼ˆåˆ›å»ºä¼šè¯ï¼‰
     ```python
     # è¾“å…¥ï¼šcase_id
     # éªŒè¯ï¼šç—…ä¾‹å­˜åœ¨ã€ç”¨æˆ·å·²ç™»å½•
     # åˆ›å»ºä¼šè¯è®°å½•ï¼ˆçŠ¶æ€ï¼šin_progressï¼‰
     # è¿”å›ï¼šsession_id
     ```
   - `GET /api/sessions`ï¼ˆç”¨æˆ·å†å²ä¼šè¯åˆ—è¡¨ï¼‰
     ```python
     # è¿”å›å½“å‰ç”¨æˆ·æ‰€æœ‰ä¼šè¯ï¼ˆåˆ†é¡µï¼‰
     # åŒ…å«ï¼šsession_id, case_title, status, created_at
     ```
   - `GET /api/sessions/{session_id}`ï¼ˆä¼šè¯è¯¦æƒ…ï¼‰
     ```python
     # è¿”å›ï¼šä¼šè¯åŸºæœ¬ä¿¡æ¯ + æ¶ˆæ¯å†å²ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
     # æƒé™æ£€æŸ¥ï¼šä»…ä¼šè¯æ‰€å±ç”¨æˆ·å¯è®¿é—®
     ```

2. **æ ¸å¿ƒèŠå¤©æ¥å£**ï¼ˆ`POST /api/chat`ï¼‰â€”â€” **æœ€å…³é”®**

   **è¾“å…¥**ï¼š

   ```json
   {
     "session_id": "uuid",
     "message": "æ‚£è€…æ‚¨å¥½ï¼Œè¯·é—®å“ªé‡Œä¸èˆ’æœï¼Ÿ"
   }
   ```

**æ ¸å¿ƒé€»è¾‘**ï¼š

```python
async def chat_stream(session_id: str, message: str, user_id: int):
    # 1. æƒé™æ£€æŸ¥ï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è¯¥ä¼šè¯
    session = await get_session(session_id)
    if session.user_id != user_id:
        raise HTTPException(403)

    # 2. åŠ è½½ç—…ä¾‹æ•°æ®
    case = await get_case(session.case_id)

    # 3. æ„é€  Prompt
    system_prompt = "ä½ æ˜¯ä¸€åæ‚£è€…ï¼Œæ­£åœ¨æ¥å—åŒ»ç”Ÿé—®è¯Šã€‚ä½ ä¸èƒ½åšè¯Šæ–­ï¼Œåªèƒ½æ ¹æ®è‡ªèº«ç—‡çŠ¶å›ç­”åŒ»ç”Ÿçš„é—®é¢˜ã€‚"
    developer_prompt = f"""
    ç—…ä¾‹ä¿¡æ¯ï¼š
    - ä¸»è¯‰ï¼š{case.chief_complaint}
    - ç°ç—…å²ï¼š{case.present_illness}
    - å¯é€éœ²ä½“å¾ï¼š{case.physical_exam['on_request']}

    æ³¨æ„ï¼š
    1. åªå›ç­”åŒ»ç”Ÿç›´æ¥è¯¢é—®çš„å†…å®¹
    2. ä¸è¦ä¸»åŠ¨æä¾›æœªè¯¢é—®çš„ä¿¡æ¯
    3. ä¸è¦ä½¿ç”¨åŒ»å­¦æœ¯è¯­ï¼Œç”¨æ‚£è€…è¯­è¨€æè¿°
    """

    # 4. åŠ è½½å†å²æ¶ˆæ¯ï¼ˆæœ€è¿‘ 10 è½®æˆ–æ‘˜è¦ï¼‰
    history = await get_recent_messages(session_id, limit=20)

    # 5. ç»„è£…è¯·æ±‚
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "developer", "content": developer_prompt},
        *history,
        {"role": "user", "content": message}
    ]

    # 6. è°ƒç”¨ vLLMï¼ˆæµå¼ï¼‰
    async with httpx.AsyncClient() as client:
        response = await client.post(
            f"{settings.LLM_BASE_URL}/v1/chat/completions",
            json={
                "model": settings.LLM_MODEL,
                "messages": messages,
                "stream": True,
                "temperature": 0.7,
                "max_tokens": 500
            },
            timeout=60.0
        )

        # 7. SSE æµå¼è¿”å›
        async def event_generator():
            full_response = ""
            start_time = time.time()

            async for line in response.aiter_lines():
                if line.startswith("data: "):
                    data = line[6:]
                    if data == "[DONE]":
                        break
                    chunk = json.loads(data)
                    content = chunk["choices"][0]["delta"].get("content", "")
                    full_response += content
                    yield f"data: {json.dumps({'content': content})}\n\n"

            # 8. æµå¼ç»“æŸï¼Œè½åº“
            latency = int((time.time() - start_time) * 1000)
            await save_messages(session_id, [
                {"role": "user", "content": message, "tokens": count_tokens(message)},
                {"role": "assistant", "content": full_response, "tokens": count_tokens(full_response), "latency": latency}
            ])

            yield "data: [DONE]\n\n"

        return StreamingResponse(event_generator(), media_type="text/event-stream")
```

**ç—…äºº persona ç¨³å®šæ€§**ï¼š

- System + Developer Prompt å›ºåŒ–â€œåªå½“ç—…äººã€ä¸å¾—ç»™è¯Šæ–­â€çº¦æŸ
- å†å²ä¸Šä¸‹æ–‡ä»…åŒ…å« user/assistant æ¶ˆæ¯ï¼Œä¸æ··å…¥è¯„åˆ†æˆ–æ•™å¸ˆè¯­å¢ƒ
- Prompt æ¨¡æ¿ç‹¬ç«‹å­˜æ”¾ï¼ˆä¾¿äºç‰ˆæœ¬åŒ–ä¸å®¡è®¡ï¼‰

3. **ä¸Šä¸‹æ–‡ç®¡ç†ç­–ç•¥**ï¼ˆé˜²æ­¢çˆ†ç‚¸ï¼‰

   - æ–¹æ¡ˆ Aï¼šæ»‘åŠ¨çª—å£ï¼ˆä¿ç•™æœ€è¿‘ N è½®ï¼‰
   - æ–¹æ¡ˆ Bï¼šå®šæœŸæ‘˜è¦ï¼ˆä½¿ç”¨ LLM æ€»ç»“å†å²ï¼‰
   - åˆæœŸï¼šå›ºå®šä¿ç•™æœ€è¿‘ 10 è½®ï¼ˆ20 æ¡æ¶ˆæ¯ï¼‰

4. **æµ‹è¯•**
   - ä½¿ç”¨ `curl` æµ‹è¯• SSE æµå¼å“åº”
   - Postman æˆ–å‰ç«¯ EventSource é›†æˆ
   - éªŒè¯æ•°æ®åº“æ¶ˆæ¯è®°å½•å®Œæ•´æ€§

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] åˆ›å»ºä¼šè¯æˆåŠŸï¼Œè¿”å› session_id
- [ ] `/api/chat` æµå¼è¿”å›å†…å®¹
- [ ] å‰ç«¯å¯å®æ—¶æ¸²æŸ“æµå¼æ–‡æœ¬
- [ ] æ¶ˆæ¯æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆå« tokensã€å»¶è¿Ÿï¼‰
- [ ] ç—…äººè§’è‰²ç¨³å®šï¼ˆä¸åšè¯Šæ–­ï¼‰

---

### **ç¬¬ 4 å‘¨ï¼šå¢å¼ºåŠŸèƒ½ä¸ç¨³å®šæ€§ï¼ˆé˜¶æ®µ 6-8ï¼‰**

#### **Day 22-24ï¼šæ£€æŸ¥ç”³è¯·æœºåˆ¶**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **æ£€æŸ¥ç”³è¯· API**ï¼ˆ`POST /api/sessions/{session_id}/tests`ï¼‰

   ```python
   # è¾“å…¥ï¼štest_typeï¼ˆå¦‚ "blood_routine"ï¼‰
   # éªŒè¯ï¼š
   #   1. ä¼šè¯å½’å±æƒé™
   #   2. æ£€æŸ¥ç±»å‹åœ¨ç—…ä¾‹ available_tests ä¸­
   #   3. æœªé‡å¤ç”³è¯·ï¼ˆå¯é€‰ï¼Œæˆ–å…è®¸é‡å¤ï¼‰
   # è¿”å›ï¼šæ£€æŸ¥ç»“æœï¼ˆä»ç—…ä¾‹ JSON è¯»å–ï¼‰
   # è½åº“ï¼štest_requests è¡¨
   ```

2. **å·²ç”³è¯·æ£€æŸ¥åˆ—è¡¨**ï¼ˆ`GET /api/sessions/{session_id}/tests`ï¼‰

   ```python
   # è¿”å›è¯¥ä¼šè¯æ‰€æœ‰å·²ç”³è¯·çš„æ£€æŸ¥åŠç»“æœ
   ```

3. **å¯ç”¨æ£€æŸ¥åˆ—è¡¨**ï¼ˆ`GET /api/cases/{case_id}/available-tests`ï¼‰

   ```python
   # è¿”å›ç—…ä¾‹æ”¯æŒçš„æ£€æŸ¥é¡¹ï¼ˆä¸å«ç»“æœï¼‰
   # ç”¨äºå‰ç«¯å±•ç¤ºå¯é€‰æ£€æŸ¥é¢æ¿
   ```

4. **å‰ç«¯è”è°ƒå‡†å¤‡**
   - æä¾› OpenAPI schema æˆ–æ–‡æ¡£
   - ç¤ºä¾‹è¯·æ±‚/å“åº”

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] ç”³è¯·æ£€æŸ¥æˆåŠŸè¿”å›ç»“æœ
- [ ] é‡å¤ç”³è¯·å¤„ç†æ­£ç¡®ï¼ˆæ ¹æ®ä¸šåŠ¡è§„åˆ™ï¼‰
- [ ] æ£€æŸ¥è®°å½•ä¿å­˜åˆ°æ•°æ®åº“
- [ ] éæ³•æ£€æŸ¥ç±»å‹è¿”å› 400 é”™è¯¯

---

#### **Day 25-27ï¼šè¯„åˆ†ç³»ç»Ÿï¼ˆè§„åˆ™è¯„åˆ† MVPï¼‰**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **è¯„åˆ†é€»è¾‘è®¾è®¡**ï¼ˆ`src/apps/api/services/scoring.py`ï¼‰

   **è¯„åˆ†ç»´åº¦**ï¼š

   - **é—®è¯Šå®Œæ•´æ€§**ï¼ˆ40%ï¼‰ï¼šå…³é”®é—®è¯Šç‚¹è¦†ç›–ç‡
   - **çº¢æ——ç—‡çŠ¶è¯†åˆ«**ï¼ˆ20%ï¼‰ï¼šæ˜¯å¦è¯¢é—®å±é™©ç—‡çŠ¶
   - **æ£€æŸ¥åˆç†æ€§**ï¼ˆ20%ï¼‰ï¼šç”³è¯·æ£€æŸ¥æ˜¯å¦æ°å½“
   - **è¯Šæ–­å‡†ç¡®æ€§**ï¼ˆ20%ï¼‰ï¼šå­¦ç”Ÿæäº¤çš„è¯Šæ–­ä¸æ ‡å‡†ç­”æ¡ˆåŒ¹é…åº¦

   **å®ç°æ–¹æ³•**ï¼š

   ```python
   def calculate_score(session: Session, case: Case, submitted_diagnosis: str) -> dict:
       # 1. ä»æ¶ˆæ¯å†å²æå–å…³é”®è¯
       messages = get_session_messages(session.id)
       keywords_asked = extract_keywords(messages)

       # 2. ä¸ç—…ä¾‹ key_points å¯¹æ¯”
       key_points_coverage = len(set(keywords_asked) & set(case.key_points)) / len(case.key_points)

       # 3. æ£€æŸ¥ç”³è¯·åˆç†æ€§
       tests = get_session_tests(session.id)
       appropriate_tests = [t for t in tests if t.type in case.recommended_tests]
       test_score = len(appropriate_tests) / max(len(case.recommended_tests), 1)

       # 4. è¯Šæ–­åŒ¹é…åº¦ï¼ˆç®€å•å…³é”®è¯åŒ¹é…ï¼‰
       diagnosis_match = any(kw in submitted_diagnosis for kw in case.standard_diagnosis["primary"])

       # 5. ç»¼åˆè®¡ç®—
       total_score = (
           key_points_coverage * 40 +
           test_score * 20 +
           (100 if diagnosis_match else 0) * 0.2
       )

       return {
           "total_score": round(total_score, 2),
           "dimensions": {
               "interview_completeness": round(key_points_coverage * 100, 2),
               "test_appropriateness": round(test_score * 100, 2),
               "diagnosis_accuracy": 100 if diagnosis_match else 0
           },
           "details": {
               "keywords_asked": keywords_asked,
               "key_points_covered": list(set(keywords_asked) & set(case.key_points))
           }
       }
   ```

2. **æäº¤è¯Šæ–­ API**ï¼ˆ`POST /api/sessions/{session_id}/submit`ï¼‰

   ```python
   # è¾“å…¥ï¼šdiagnosisï¼ˆå­¦ç”Ÿçš„è¯Šæ–­ç»“è®ºï¼‰
   # éªŒè¯ï¼šä¼šè¯å½’å±ã€ä¼šè¯çŠ¶æ€ï¼ˆæœªæäº¤ï¼‰
   # æ‰§è¡Œï¼š
   #   1. æ›´æ–°ä¼šè¯çŠ¶æ€ä¸º "submitted"
   #   2. è°ƒç”¨è¯„åˆ†é€»è¾‘
   #   3. ä¿å­˜è¯„åˆ†ç»“æœåˆ° scores è¡¨
   # è¿”å›ï¼šè¯„åˆ†æŠ¥å‘Š
   ```

3. **æŸ¥çœ‹è¯„åˆ† API**ï¼ˆ`GET /api/sessions/{session_id}/score`ï¼‰

   ```python
   # è¿”å›è¯¥ä¼šè¯çš„è¯„åˆ†è¯¦æƒ…ï¼ˆéœ€å·²æäº¤ï¼‰
   ```

4. **è¯„ä¼°å·¥ä½œæµæœ€ä½³å®è·µ**

   - ä¸å¯¹è¯é“¾è·¯è§£è€¦ï¼šè¯„åˆ†/ç‚¹è¯„åœ¨åå°ä»»åŠ¡æˆ–ç‹¬ç«‹è°ƒç”¨ä¸­æ‰§è¡Œï¼Œä¸æ±¡æŸ“ç—…äºº persona
   - è¯„åˆ†è¾“å…¥ï¼šç—…ä¾‹æ ‡å‡†ç­”æ¡ˆ/å…³é”®ç‚¹ + ä¼šè¯æ‘˜è¦æˆ–æœ€è¿‘ N è½® + ç”¨æˆ·æäº¤è¯Šæ–­ + å·²ç”³è¯·æ£€æŸ¥
   - è¾“å‡ºï¼šç»“æ„åŒ– JSONï¼ˆæ€»åˆ†ã€ç»´åº¦åˆ†ã€è¦†ç›–å…³é”®ç‚¹ã€ä½¿ç”¨çš„æ¨¡å‹/è§„åˆ™ç‰ˆæœ¬ã€trace_idï¼‰
   - å¹‚ç­‰ä¸å®¡è®¡ï¼šscores è¡¨å”¯ä¸€ç´¢å¼• session_idï¼›scores.details è®°å½•è§„åˆ™ç‰ˆæœ¬ã€æ¨¡å‹ç‰ˆæœ¬ä¸è¾“å…¥æ‘˜è¦ï¼Œaudit_logs è®°å½•è§¦å‘è€…

5. **æ’è¡Œæ¦œä¸æ•°æ®æŒä¹…åŒ–åµŒå…¥**

   - æ•°æ®è½åº“ï¼šmessagesï¼ˆtokens/latencyï¼‰ã€sessionsï¼ˆçŠ¶æ€ï¼‰ã€scoresï¼ˆè¯„åˆ† JSONï¼‰ã€audit_logsï¼ˆtrace_idï¼‰
   - æ’è¡Œæ¦œç”Ÿæˆï¼šæ–°å¢æ‰¹å¤„ç†/è§†å›¾èšåˆç”¨æˆ·ç»´åº¦çš„å¹³å‡åˆ†ã€æœ€è¿‘ N æ¬¡å¹³å‡ã€å®Œæˆåœºæ¬¡ï¼Œå†™å…¥ leaderboard è¡¨æˆ–ç‰©åŒ–è§†å›¾
   - APIï¼š`GET /api/leaderboard` è¯»å–èšåˆç»“æœï¼ˆå¯æŒ‰æ—¶é—´çª—å£è¿‡æ»¤ï¼‰
   - æ›´æ–°å¼€å‘è®¡åˆ’ï¼šæ’è¡Œæ¦œä»»åŠ¡å¯ä¸è¯„åˆ†å¹¶è¡Œå¼€å‘ï¼Œå‰ç«¯ç›´æ¥æ¶ˆè´¹èšåˆç»“æœ

6. **æµ‹è¯•**
   - å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆå®Œæ•´å¯¹è¯ + æäº¤è¯Šæ–­ï¼‰
   - éªŒè¯è¯„åˆ†è®¡ç®—æ­£ç¡®æ€§
   - æ£€æŸ¥è¯„åˆ†ä¾æ®å¯å®¡è®¡ï¼ˆJSON ä¿å­˜å®Œæ•´ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] æäº¤è¯Šæ–­åè¿”å›è¯„åˆ†æŠ¥å‘Š
- [ ] è¯„åˆ†é€»è¾‘åˆç†ï¼Œå¯è§£é‡Š
- [ ] è¯„åˆ†æ•°æ®å®Œæ•´ä¿å­˜åˆ°æ•°æ®åº“
- [ ] é‡å¤æäº¤è¿”å›å·²æœ‰è¯„åˆ†ï¼ˆæˆ–æç¤ºé”™è¯¯ï¼‰

---

#### **Day 28ï¼šå·¥ç¨‹åŒ–è¡¥å¼º**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **æ—¥å¿—ç³»ç»Ÿ**

   - å®‰è£… `loguru`ï¼š`uv add loguru`
   - é…ç½®æ—¥å¿—æ ¼å¼ï¼ˆ`src/apps/api/logging_config.py`ï¼‰

     ```python
     from loguru import logger
     import sys

     logger.remove()  # ç§»é™¤é»˜è®¤ handler
     logger.add(
         sys.stdout,
         format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> | <level>{message}</level>",
         level="INFO"
     )
     logger.add(
         "logs/app_{time:YYYY-MM-DD}.log",
         rotation="00:00",
         retention="30 days",
         level="DEBUG"
     )
     ```

   - åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—ï¼š
     - ç”¨æˆ·ç™»å½•
     - ä¼šè¯åˆ›å»º
     - å¯¹è¯è¯·æ±‚ï¼ˆå« trace_idï¼‰
     - é”™è¯¯æ•è·

2. **Trace ID æ”¯æŒ**

   - ä½¿ç”¨ FastAPI middleware ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆ `trace_id`
   - æ·»åŠ åˆ°å“åº”å¤´å’Œæ—¥å¿—

3. **å…¨å±€å¼‚å¸¸å¤„ç†**

   ```python
   from fastapi import Request
   from fastapi.responses import JSONResponse

   @app.exception_handler(Exception)
   async def global_exception_handler(request: Request, exc: Exception):
       logger.error(f"Unhandled exception: {exc}", exc_info=True)
       return JSONResponse(
           status_code=500,
           content={"detail": "Internal server error", "trace_id": request.state.trace_id}
       )
   ```

4. **é™æµï¼ˆå¯é€‰ï¼Œç®€å•å®ç°ï¼‰**
   - ä½¿ç”¨ `slowapi`ï¼šæ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š 20 æ¬¡å¯¹è¯è¯·æ±‚
   - é˜²æ­¢æ»¥ç”¨ vLLM èµ„æº

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] æ—¥å¿—æ–‡ä»¶æ­£å¸¸ç”Ÿæˆï¼Œæ ¼å¼æ¸…æ™°
- [ ] Trace ID è´¯ç©¿è¯·æ±‚é“¾è·¯
- [ ] å…¨å±€å¼‚å¸¸è¢«æ•è·ï¼Œè¿”å›ç»Ÿä¸€æ ¼å¼
- [ ] é™æµç”Ÿæ•ˆï¼ˆæµ‹è¯•è¶…é™è¿”å› 429ï¼‰

---

### **ç¬¬ 5 å‘¨ï¼šå‰ç«¯å¯¹æ¥ä¸å®Œæ•´é“¾è·¯ï¼ˆé˜¶æ®µ 7ï¼‰**

#### **Day 29-31ï¼šå‰ç«¯åŸºç¡€å¼€å‘**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **æŠ€æœ¯æ ˆç¡®å®š**

   - æ¡†æ¶ï¼šVue 3 + Vite + TypeScript
   - UI åº“ï¼šVant 4ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰
   - çŠ¶æ€ç®¡ç†ï¼šPiniaï¼ˆå¯é€‰ï¼‰
   - HTTP å®¢æˆ·ç«¯ï¼šaxios
   - SSE å®¢æˆ·ç«¯ï¼šåŸç”Ÿ EventSource æˆ– fetch

2. **é¡¹ç›®åˆå§‹åŒ–**

   ```bash
   cd src/apps/web
   npm create vite@latest . -- --template vue-ts
   npm install
   npm install vant @vant/auto-import-resolver unplugin-vue-components -D
   npm install axios pinia
   ```

3. **æ ¸å¿ƒé¡µé¢å¼€å‘**

   **ç™»å½•é¡µ**ï¼ˆ`/login`ï¼‰ï¼š

   - è¡¨å•ï¼šç”¨æˆ·å + å¯†ç 
   - è°ƒç”¨ `POST /api/auth/login`
   - ä¿å­˜ JWT åˆ° localStorage
   - è·³è½¬åˆ°ç—…ä¾‹åˆ—è¡¨

   **ç—…ä¾‹åˆ—è¡¨é¡µ**ï¼ˆ`/cases`ï¼‰ï¼š

   - è°ƒç”¨ `GET /api/cases`
   - å±•ç¤ºå¡ç‰‡åˆ—è¡¨ï¼ˆéš¾åº¦ã€ç§‘å®¤æ ‡ç­¾ï¼‰
   - ç‚¹å‡»è¿›å…¥ä¼šè¯åˆ›å»º

   **ä¼šè¯åˆ›å»º**ï¼ˆé€‰æ‹©ç—…ä¾‹åï¼‰ï¼š

   - è°ƒç”¨ `POST /api/sessions`
   - è·³è½¬åˆ°å¯¹è¯é¡µ

   **å¯¹è¯é¡µ**ï¼ˆ`/chat/{session_id}`ï¼‰ï¼š

   - èŠå¤©æ°”æ³¡ UIï¼ˆåŒ»ç”Ÿ/æ‚£è€…è§’è‰²åŒºåˆ†ï¼‰
   - è¾“å…¥æ¡† + å‘é€æŒ‰é’®
   - SSE æµå¼æ¸²æŸ“ï¼ˆé€å­—æ˜¾ç¤ºï¼‰
   - æ£€æŸ¥ç”³è¯·æµ®åŠ¨æŒ‰é’®ï¼ˆè¿›å…¥æ£€æŸ¥é¢æ¿ï¼‰

   **æ£€æŸ¥ç”³è¯·é¢æ¿**ï¼ˆå¼¹å‡ºå±‚ï¼‰ï¼š

   - æ˜¾ç¤ºå¯ç”¨æ£€æŸ¥åˆ—è¡¨
   - ç‚¹å‡»ç”³è¯·ï¼Œè°ƒç”¨ `POST /api/sessions/{session_id}/tests`
   - æ˜¾ç¤ºç»“æœå¼¹çª—

   **è¯Šæ–­æäº¤é¡µ**ï¼ˆå¯¹è¯é¡µå†…æˆ–ç‹¬ç«‹é¡µï¼‰ï¼š

   - æ–‡æœ¬æ¡†è¾“å…¥è¯Šæ–­ç»“è®º
   - è°ƒç”¨ `POST /api/sessions/{session_id}/submit`
   - æ˜¾ç¤ºè¯„åˆ†æŠ¥å‘Š

   **ä¼šè¯å†å²é¡µ**ï¼ˆ`/sessions`ï¼‰ï¼š

   - è°ƒç”¨ `GET /api/sessions`
   - åˆ—è¡¨å±•ç¤ºï¼Œç‚¹å‡»è¿›å…¥å¯¹è¯é¡µï¼ˆåªè¯»æ¨¡å¼ï¼‰

4. **SSE é›†æˆç¤ºä¾‹**

   ```typescript
   async function sendMessage(sessionId: string, message: string) {
     const response = await fetch(`${API_BASE}/api/chat`, {
       method: "POST",
       headers: {
         "Content-Type": "application/json",gg
         Authorization: `Bearer ${token}`,
       },
       body: JSON.stringify({ session_id: sessionId, message }),
     });

     const reader = response.body!.getReader();
     const decoder = new TextDecoder();

     while (true) {
       const { done, value } = await reader.read();
       if (done) break;

       const text = decoder.decode(value);
       const lines = text.split("\n");

       for (const line of lines) {
         if (line.startsWith("data: ")) {
           const data = line.slice(6);
           if (data === "[DONE]") return;

           const { content } = JSON.parse(data);
           // è¿½åŠ åˆ° UI
           appendToAssistantMessage(content);
         }
       }
     }
   }
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] ç™»å½•é¡µæ­£å¸¸å·¥ä½œï¼ŒJWT ä¿å­˜æˆåŠŸ
- [ ] ç—…ä¾‹åˆ—è¡¨åŠ è½½å¹¶å±•ç¤º
- [ ] å¯¹è¯é¡µæµå¼å“åº”æ­£å¸¸ï¼ˆé€å­—æ˜¾ç¤ºï¼‰
- [ ] æ£€æŸ¥ç”³è¯·å’Œç»“æœæ˜¾ç¤ºæ­£ç¡®
- [ ] æäº¤è¯Šæ–­åæ˜¾ç¤ºè¯„åˆ†

---

#### **Day 32-33ï¼šå‰åç«¯è”è°ƒ**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **E2E æµ‹è¯•æµç¨‹**

   - ç”¨æˆ·ç™»å½• â†’ æŸ¥çœ‹ç—…ä¾‹ â†’ åˆ›å»ºä¼šè¯
   - è¿›è¡Œå¤šè½®å¯¹è¯ï¼ˆè‡³å°‘ 5 è½®ï¼‰
   - ç”³è¯·æ£€æŸ¥ï¼ˆ2-3 é¡¹ï¼‰
   - æäº¤è¯Šæ–­ â†’ æŸ¥çœ‹è¯„åˆ†
   - æŸ¥çœ‹å†å²ä¼šè¯

2. **é—®é¢˜ä¿®å¤**

   - **CORS é”™è¯¯**ï¼šç¡®è®¤åç«¯ CORS é…ç½®
   - **SSE ç¼“å†²**ï¼šNginx é…ç½® `proxy_buffering off`ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
   - **è¶…æ—¶**ï¼šè°ƒæ•´ httpx timeoutï¼Œå‰ç«¯é‡è¿é€»è¾‘
   - **Token è¿‡æœŸ**ï¼šå‰ç«¯è‡ªåŠ¨åˆ·æ–°æˆ–è·³è½¬ç™»å½•

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - åŠ è½½çŠ¶æ€ï¼ˆéª¨æ¶å±ï¼‰
   - é”™è¯¯æç¤ºï¼ˆToastï¼‰
   - æµå¼è¾“å…¥æ—¶ç¦ç”¨å‘é€æŒ‰é’®
   - æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] å®Œæ•´æµç¨‹æ— é˜»å¡
- [ ] æ•°æ®åº“è®°å½•å®Œæ•´ä¸”å‡†ç¡®
- [ ] å‰ç«¯äº¤äº’æµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿
- [ ] é”™è¯¯å¤„ç†å‹å¥½

---

#### **Day 34-35ï¼šæµ‹è¯•è¦†ç›–**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **åç«¯å•å…ƒæµ‹è¯•**ï¼ˆpytestï¼‰

   - æµ‹è¯•é…ç½®åŠ è½½ï¼ˆ`test_config.py`ï¼‰
   - æµ‹è¯•è¯„åˆ†é€»è¾‘ï¼ˆ`test_scoring.py`ï¼‰
   - æµ‹è¯• Prompt æ„é€ ï¼ˆ`test_prompt_builder.py`ï¼‰

2. **åç«¯é›†æˆæµ‹è¯•**

   - ä½¿ç”¨ TestClient æ¨¡æ‹Ÿè¯·æ±‚
   - æµ‹è¯•ç™»å½• â†’ åˆ›å»ºä¼šè¯ â†’ å¯¹è¯ â†’ æäº¤ï¼ˆmock vLLMï¼‰
   - æ•°æ®åº“ä½¿ç”¨ SQLite å†…å­˜æ¨¡å¼

3. **å‰ç«¯æµ‹è¯•**ï¼ˆå¯é€‰ï¼‰
   - Vitest ç»„ä»¶æµ‹è¯•
   - Playwright E2E æµ‹è¯•ï¼ˆæŒ‰éœ€ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] åç«¯æµ‹è¯•è¦†ç›–ç‡ > 60%ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] CI/CD é›†æˆï¼ˆGitHub Actionsï¼Œå¯é€‰ï¼‰

---

### **ç¬¬ 6 å‘¨ï¼šç”Ÿäº§å‡†å¤‡ï¼ˆé˜¶æ®µ 9ï¼‰**

#### **Day 36-37ï¼šDocker åŒ–åç«¯**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **ç¼–å†™ Dockerfile**ï¼ˆ`src/apps/api/Dockerfile`ï¼‰

   ```dockerfile
   FROM python:3.11-slim

   WORKDIR /app

   # å®‰è£… uv
   RUN pip install uv

   # å¤åˆ¶ä¾èµ–æ–‡ä»¶
   COPY pyproject.toml uv.lock ./

   # å®‰è£…ä¾èµ–
   RUN uv sync --frozen --no-dev

   # å¤åˆ¶åº”ç”¨ä»£ç 
   COPY src/ ./src/

   # æš´éœ²ç«¯å£
   EXPOSE 8000

   # å¯åŠ¨å‘½ä»¤
   CMD ["uv", "run", "uvicorn", "src.apps.api.main:app", "--host", "0.0.0.0", "--port", "8000"]
   ```

2. **æ›´æ–° `dev.yml`**ï¼ˆåŠ å…¥ api æœåŠ¡ï¼‰

   ```yaml
   services:
     postgres:
       # ...
     minio:
       # ...
     api:
       build:
         context: ../../..
         dockerfile: src/apps/api/Dockerfile
       ports:
         - "8000:8000"
       environment:
         DATABASE_URL: postgresql+psycopg://postgres:postgres@postgres:5432/clinic_sim
         MINIO_ENDPOINT: minio:9000
         LLM_BASE_URL: http://host.docker.internal:8001 # WSL2 è®¿é—®å®¿ä¸»æœº
       depends_on:
         - postgres
         - minio
       volumes:
         - ./src:/app/src # å¼€å‘æ—¶çƒ­é‡è½½
   ```

3. **æµ‹è¯• Docker Compose å®Œæ•´å¯åŠ¨**
   ```bash
   docker-compose -f src/infra/compose/dev.yml up --build
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] `docker-compose ps` æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡ healthy
- [ ] å®¹å™¨å†… API å¯è®¿é—® vLLMï¼ˆå®¿ä¸»æœºï¼‰
- [ ] æ•°æ®åº“è¿ç§»è‡ªåŠ¨æ‰§è¡Œï¼ˆæˆ–æ‰‹åŠ¨æ‰§è¡Œï¼‰
- [ ] æ—¥å¿—æ­£å¸¸è¾“å‡º

---

#### **Day 38-39ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **ç¼–å†™ `prod-b.yml`**ï¼ˆB æœåŠ¡å™¨ï¼ŒGPUï¼‰

   ```yaml
   services:
     postgres:
       image: postgres:15
       environment:
         POSTGRES_PASSWORD: ${DB_PASSWORD}
       volumes:
         - pg_data:/var/lib/postgresql/data

     minio:
       image: minio/minio
       command: server /data --console-address ":9001"
       environment:
         MINIO_ROOT_USER: ${MINIO_USER}
         MINIO_ROOT_PASSWORD: ${MINIO_PASSWORD}
       volumes:
         - minio_data:/data

     vllm:
       image: vllm/vllm-openai:latest
       runtime: nvidia
       environment:
         CUDA_VISIBLE_DEVICES: "0"
       command: >
         --model /models/qwen2.5-7b-instruct
         --port 8001
         --max-model-len 8192
         --gpu-memory-utilization 0.9
       volumes:
         - /path/to/models:/models
       ports:
         - "8001:8001"

     api:
       build: ../../..
       environment:
         DATABASE_URL: postgresql+psycopg://postgres:${DB_PASSWORD}@postgres:5432/clinic_sim
         LLM_BASE_URL: http://vllm:8001
         ENV: production
       depends_on:
         - postgres
         - minio
         - vllm
       ports:
         - "8000:8000"
   ```

2. **ç¼–å†™ `prod-a.yml`**ï¼ˆA æœåŠ¡å™¨ï¼Œå‰ç«¯ï¼‰

   ```yaml
   services:
     nginx:
       image: nginx:alpine
       ports:
         - "80:80"
         - "443:443"
       volumes:
         - ../nginx/nginx.conf:/etc/nginx/nginx.conf:ro
         - ../nginx/ssl:/etc/nginx/ssl:ro
         - ../../apps/web/dist:/usr/share/nginx/html:ro
   ```

3. **Nginx é…ç½®**ï¼ˆ`src/infra/nginx/nginx.conf`ï¼‰

   ```nginx
   upstream backend {
       server <BæœåŠ¡å™¨IP>:8000;
   }

   server {
       listen 443 ssl http2;
       server_name yourdomain.com;

       ssl_certificate /etc/nginx/ssl/cert.pem;
       ssl_certificate_key /etc/nginx/ssl/key.pem;

       # å‰ç«¯é™æ€æ–‡ä»¶
       location / {
           root /usr/share/nginx/html;
           try_files $uri $uri/ /index.html;
       }

       # API ä»£ç†
       location /api/ {
           proxy_pass http://backend;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }

       # SSE ä»£ç†ï¼ˆå…³é”®é…ç½®ï¼‰
       location /api/chat {
           proxy_pass http://backend;
           proxy_buffering off;  # ç¦ç”¨ç¼“å†²
           proxy_cache off;
           proxy_set_header Connection '';
           proxy_http_version 1.1;
           chunked_transfer_encoding off;
       }
   }
   ```

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] `prod-b.yml` é…ç½®å®Œæ•´ï¼Œç¯å¢ƒå˜é‡å¤–éƒ¨åŒ–
- [ ] `prod-a.yml` Nginx é…ç½®æ­£ç¡®
- [ ] SSL è¯ä¹¦è·¯å¾„é…ç½®ï¼ˆæµ‹è¯•ç¯å¢ƒå¯ç”¨è‡ªç­¾åï¼‰

---

#### **Day 40-42ï¼šéƒ¨ç½²ä¸éªŒè¯**

**ä»»åŠ¡æ¸…å•**ï¼š

1. **éƒ¨ç½²åˆ° B æœåŠ¡å™¨**

   ```bash
   # æ£€æŸ¥ GPU
   nvidia-smi

   # æ‹‰å–ä»£ç 
   git clone <repo_url>
   cd clinic-sim

   # é…ç½®ç¯å¢ƒå˜é‡
   cp .env.production.example .env.production
   vim .env.production  # å¡«å†™å¯†ç ã€å¯†é’¥

   # å¯åŠ¨æœåŠ¡
   docker-compose -f src/infra/compose/prod-b.yml up -d

   # æŸ¥çœ‹æ—¥å¿—
   docker-compose -f src/infra/compose/prod-b.yml logs -f api
   ```

2. **éƒ¨ç½²åˆ° A æœåŠ¡å™¨**

   ```bash
   # æ„å»ºå‰ç«¯
   cd src/apps/web
   npm run build

   # ä¸Šä¼  dist/ åˆ° A æœåŠ¡å™¨

   # å¯åŠ¨ Nginx
   docker-compose -f src/infra/compose/prod-a.yml up -d
   ```

3. **éªŒè¯**

   - è®¿é—® `https://yourdomain.com`
   - æµ‹è¯•ç™»å½• â†’ å¯¹è¯ â†’ è¯„åˆ†å®Œæ•´æµç¨‹
   - æ£€æŸ¥ HTTPS è¯ä¹¦
   - æµ‹è¯• SSE æµå¼å“åº”ï¼ˆChrome DevTools Networkï¼‰

4. **å‹åŠ›æµ‹è¯•**

   - ä½¿ç”¨ `locust` æˆ– `ab` æ¨¡æ‹Ÿå¹¶å‘
   - ç›‘æ§ GPU åˆ©ç”¨ç‡ï¼ˆ`nvidia-smi dmon`ï¼‰
   - ç›‘æ§å†…å­˜/OOMï¼ˆ`docker stats`ï¼‰
   - è°ƒä¼˜ vLLM å‚æ•°ï¼š
     - `max_model_len`
     - `max_num_seqs`ï¼ˆå¹¶å‘æ•°ï¼‰
     - `gpu_memory_utilization`

5. **å¯è§‚æµ‹æ€§éƒ¨ç½²**ï¼ˆå¯é€‰ï¼‰
   - Prometheus + Grafanaï¼ˆç›‘æ§ QPSã€å»¶è¿Ÿï¼‰
   - å¯¼å‡º vLLM metricsï¼ˆ`--enable-metrics`ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š

- [ ] ç”Ÿäº§ç¯å¢ƒå¯è®¿é—®ï¼ˆHTTPSï¼‰
- [ ] å®Œæ•´æµç¨‹æ— é”™è¯¯
- [ ] å¹¶å‘ 10 ä¸ªç”¨æˆ·æ— å´©æºƒ
- [ ] GPU åˆ©ç”¨ç‡ç¨³å®šï¼ˆä¸ OOMï¼‰
- [ ] æ—¥å¿—å®Œæ•´ï¼Œå¯è¿½æº¯é—®é¢˜

---

## ğŸ¯ **å…³é”®é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹**

| **æ—¶é—´ç‚¹** | **æ£€æŸ¥ç‚¹**     | **éªŒæ”¶æ ‡å‡†**                                             |
| ---------- | -------------- | -------------------------------------------------------- |
| ç¬¬ 1 å‘¨æœ«  | åŸºç¡€è®¾æ–½ Ready | vLLM æœ¬åœ°ç¨³å®šè¿è¡Œï¼ŒPG + MinIO å¯è¿æ¥                     |
| ç¬¬ 2 å‘¨æœ«  | åç«¯éª¨æ¶ Ready | æ•°æ®åº“è¡¨å·²å»ºï¼ŒFastAPI å¯å¯åŠ¨ï¼ŒSwagger å¯è®¿é—®             |
| ç¬¬ 3 å‘¨æœ«  | æ ¸å¿ƒåŠŸèƒ½ Ready | å¯¹è¯æµå¼å·¥ä½œï¼Œç—…ä¾‹å¯å¯¼å…¥ï¼Œæ£€æŸ¥å¯ç”³è¯·ï¼Œç™»å½•å¯ç”¨ï¼ˆæ— æ³¨å†Œï¼‰ |
| ç¬¬ 4 å‘¨æœ«  | å¢å¼ºåŠŸèƒ½ Ready | è¯„åˆ†ç³»ç»Ÿå¯ç”¨ï¼Œæ—¥å¿—å®Œå–„                                   |
| ç¬¬ 5 å‘¨æœ«  | å‰ç«¯å¯¹æ¥å®Œæˆ   | E2E æµç¨‹è·‘é€š                                             |
| ç¬¬ 6 å‘¨æœ«  | ç”Ÿäº§ç¯å¢ƒä¸Šçº¿   | A/B åŒæœºéƒ¨ç½²æˆåŠŸï¼ŒHTTPS å¯è®¿é—®                           |

---

## ğŸ“ **ä¼˜å…ˆçº§è°ƒæ•´å»ºè®®**

### å¦‚æœæ—¶é—´ç´§å¼ ï¼Œå¯ä»¥ï¼š

**å»¶å**ï¼š

- æ•™å¸ˆç®¡ç†ç«¯ï¼ˆç¬¬ä¸€ç‰ˆåªåšå­¦ç”Ÿç«¯ï¼‰
- æ¨¡å‹ç‚¹è¯„ï¼ˆä¼˜å…ˆè§„åˆ™è¯„åˆ†ï¼‰
- ä¼šè¯å¯¼å‡º PDFï¼ˆä¼˜å…ˆ JSONï¼‰
- ç”¨æˆ·åŒæ­¥è‡ªåŠ¨åŒ–ï¼ˆæ‰‹åŠ¨å¯¼å…¥å³å¯ï¼‰

**å¿…é¡»ä¿è¯**ï¼š

- vLLM ç¨³å®šæ€§ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰
- SSE å¯¹è¯ä½“éªŒï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- æ•°æ®å¯å®¡è®¡ï¼ˆæ¯”èµ›éœ€æ±‚ï¼‰
- ç™»å½•è®¤è¯ï¼ˆæ— éœ€æ³¨å†Œï¼‰

### é£é™©ç‚¹ä¸åº”å¯¹

| **é£é™©**             | **åº”å¯¹æªæ–½**                                  |
| -------------------- | --------------------------------------------- |
| RTX Pro 500 æ˜¾å­˜ä¸è¶³ | ä½¿ç”¨ 1.5B æ¨¡å‹ + é‡åŒ–ï¼Œæˆ–é™ä½ `max_model_len` |
| SSE åœ¨ Nginx ä¸‹å¡é¡¿  | æå‰éªŒè¯ `proxy_buffering off` é…ç½®           |
| ç”¨æˆ·æ•°æ®åŒæ­¥å»¶è¿Ÿ     | åˆæœŸæ‰‹åŠ¨å¯¼å…¥ CSVï¼ŒåæœŸè‡ªåŠ¨åŒ–                  |
| vLLM å¹¶å‘ OOM        | é™åˆ¶ `max_num_seqs`ï¼Œå¢åŠ é™æµ                 |

---

## ğŸ“š **é™„å½•ï¼šæŠ€æœ¯æ ˆé€ŸæŸ¥**

### å¼€å‘å·¥å…·

- **ä¾èµ–ç®¡ç†**ï¼š`uv`ï¼ˆPythonï¼‰ã€`npm`ï¼ˆå‰ç«¯ï¼‰
- **é™æ€æ£€æŸ¥**ï¼š`ruff`ï¼ˆPythonï¼‰ã€`eslint`ï¼ˆå‰ç«¯ï¼‰
- **æµ‹è¯•**ï¼š`pytest`ï¼ˆåç«¯ï¼‰ã€`vitest`ï¼ˆå‰ç«¯ï¼‰

### æ ¸å¿ƒä¾èµ–

- **åç«¯**ï¼šFastAPIã€SQLAlchemyã€Alembicã€httpxã€loguruã€pydantic-settings
- **å‰ç«¯**ï¼šVue 3ã€Viteã€Vantã€axiosã€TypeScript
- **åŸºç¡€è®¾æ–½**ï¼šPostgreSQLã€MinIOã€vLLMã€Nginxã€Docker

### WSL + VS Code çº¦å®š

- **ä¼˜å…ˆä½¿ç”¨ `uv run ...`** æ‰§è¡Œ Python å‘½ä»¤ï¼ˆä¸ä¾èµ–ç³»ç»Ÿ Pythonï¼‰
- ç¤ºä¾‹ï¼š`uv run pytest`ã€`uv run uvicorn src.apps.api.main:app --reload`
- è‹¥éœ€è¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼š`source .venv/bin/activate`

---

## ğŸ“Œ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**

æ ¹æ®å½“å‰æ—¥æœŸï¼ˆ2026-01-10ï¼‰ï¼Œå»ºè®®ï¼š

1. **ç«‹å³å¼€å§‹**ï¼šç¬¬ 1 å‘¨ Day 1-2 ä»»åŠ¡ï¼ˆDocker ç¯å¢ƒæ­å»ºï¼‰
2. **æœ¬å‘¨ç›®æ ‡**ï¼šå®ŒæˆåŸºç¡€è®¾æ–½ï¼ˆvLLM + PG + MinIOï¼‰
3. **æ¯å‘¨äº”**ï¼šè¿›è¡Œé‡Œç¨‹ç¢‘æ£€æŸ¥ï¼Œè°ƒæ•´è®¡åˆ’

å¦‚æœ‰ç–‘é—®æˆ–éœ€è¦è°ƒæ•´ä¼˜å…ˆçº§ï¼Œè¯·éšæ—¶åé¦ˆï¼
